name: Java CI

on:
  push:
    tags:
      - "v*" 
  pull_request:
    branches:
      - master

jobs:
  Build:
    strategy:
      matrix:
        jdkversion: [11]
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
        java-version: ${{ matrix.jdkversion }}
        cache: 'maven'
    - name: Build
      run: mvn -V -B clean package --file pom.xml
    - name: Find And Rename
      run:  |
             mv target/AuthMe-5.6.0.jar AuthMe.jar
             git clone https://github.com/Happy-clo/Docs.git
             git config user.name Happy-clo
             git config user.email admin@wdsj.one
             git config --global credential.helper 'cache --timeout=200'
             find Docs/static/resource -name "*.jar" -type f -delete
             cp target/*.jar Docs/static/resource/ -force
             echo "Last deploy time: $(date)" > DEPLOY_INFO.txt
             mv DEPLOY_INFO.txt Docs/static/resource/
             cd Docs
             git add static/resource/*
             git commit -m "Upload AuthMe Resource File"
             git push origin HEAD:master
    - name: upload
      uses: actions/upload-artifact@v3
      with:
       name: Authme
       path: target/*.jar
    - name: Create Release and Upload Release Asset
      uses: softprops/action-gh-release@v1
      with:
         files: |
          target/*.jar
          LICENSE 
